@using System.Web.UI.WebControls;
@model int
@using Esso.ViewModels
@using Esso.Data;
@using Esso.Models;
@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "DataMonitoring";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    EssoEntities DB = new EssoEntities();

    #region User yetkileri kontrol
    TBL_STATION stat = new TBL_STATION();
    stat = null;

    var userId = User.Identity.GetUserId();

    //User yetkileri kontrol ediliyor
    try
    {
        if (User.IsInRole("M_ADMIN"))
        {
            stat = DB.Stations.Where(a => a.ID == Model).FirstOrDefault();
        }
        else if (User.IsInRole("COMP_ADMIN"))
        {
            int cmpId = DB.Stations.Where(a => a.ID == Model && a.IS_DELETED == false).FirstOrDefault().COMPANY_ID;

            if (DB.CompanyUsers.Any(a => a.COMPANY_ID == cmpId && a.USER_ID == userId && a.IS_DELETED == false))
            {
                stat = DB.Stations.Where(a => a.ID == Model).FirstOrDefault();
            }
        }
        else if (User.IsInRole("COMP_USER"))
        {
            if (DB.StationUsers.Any(a => a.STATION_ID == Model && a.USER_ID == userId && a.IS_DELETED == false))
            {
                stat = DB.Stations.Where(a => a.ID == Model).FirstOrDefault();
            }
        }
    }
    catch (Exception)
    {

    }
    #endregion
}

@{
    if (stat == null)
    {
        @Html.Partial("_ErrorPagePartial")
    }
    else
    {
        var InverterCount = DB.Inverters.Where(x => x.STATION_ID == Model).Count();
        var stationName = DB.Stations.Where(a => a.ID == Model).FirstOrDefault().NAME;


        <link href = "~/Content/bootstrap.min.css" rel = "stylesheet" />
        <link href = "~/Content/select2.min.css" rel = "stylesheet"/>

        <div class="page-title">
            <div class="title_left">
                <h3>@stationName</h3>
            </div>
        </div>

        @Html.Partial("MenuPartial")

        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_title">
                        <h2>Production</h2>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <div id="echart_line" style="height:500px;"></div>
                        <div class="well" style="overflow: auto">
                            <div class="col-md-6">
                                <div class="btn-group">
                                    <h4 id="bakisTarih"></h4>
                                </div>
                                <div class="btn-group">
                                    <input name="beginDaily" id="single_cal4" class="form-control has-feedback-left" type="text" />
                                    <select class="selectpicker" multiple>
                                        <option>Mustard</option>
                                        <option>Ketchup</option>
                                        <option>Relish</option>
                                    </select>

                                </div>
                                <div class="btn-group">
                                    <input type="button" class="btn btn-info" id="btnListDaily" value="Show" />
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Select Multiple</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <select class="select2_multiple form-control" multiple="multiple">
                                                <option>Role Seçin</option>
                                                <option>Admin</option>
                                                <option>Developer</option>
                                                <option>Test</option>

                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>


                <br />
                <div class="row">
                    <div class="col-md-6 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>Form Basic Elements <small>different form elements</small></h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li>
                                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>
                                    <li class="dropdown">
                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                                        <ul class="dropdown-menu" role="menu">
                                            <li>
                                                <a href="#">Settings 1</a>
                                            </li>
                                            <li>
                                                <a href="#">Settings 2</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a class="close-link"><i class="fa fa-close"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <br />
                                <form class="form-horizontal form-label-left">
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Default Input</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <input type="text" class="form-control" placeholder="Default Input">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Disabled Input </label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <input type="text" class="form-control" disabled="disabled" placeholder="Disabled Input">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Read-Only Input</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <input type="text" class="form-control" readonly="readonly" placeholder="Read-Only Input">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">
                                            Date Of Birth <span class="required">*</span>
                                        </label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <textarea class="form-control" rows="3" placeholder='rows="3"'></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Password</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <input type="password" class="form-control" value="passwordonetwo">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">AutoComplete</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <input type="text" name="country" id="autocomplete-custom-append" class="form-control col-md-10" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Select</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <select class="form-control">
                                                <option>Choose option</option>
                                                <option>Option one</option>
                                                <option>Option two</option>
                                                <option>Option three</option>
                                                <option>Option four</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Select Custom</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <select class="select2_single form-control" tabindex="-1">
                                                <option></option>
                                                <option value="AK">Alaska</option>
                                                <option value="HI">Hawaii</option>
                                                <option value="CA">California</option>
                                                <option value="NV">Nevada</option>
                                                <option value="OR">Oregon</option>
                                                <option value="WA">Washington</option>
                                                <option value="AZ">Arizona</option>
                                                <option value="CO">Colorado</option>
                                                <option value="ID">Idaho</option>
                                                <option value="MT">Montana</option>
                                                <option value="NE">Nebraska</option>
                                                <option value="NM">New Mexico</option>
                                                <option value="ND">North Dakota</option>
                                                <option value="UT">Utah</option>
                                                <option value="WY">Wyoming</option>
                                                <option value="AR">Arkansas</option>
                                                <option value="IL">Illinois</option>
                                                <option value="IA">Iowa</option>
                                                <option value="KS">Kansas</option>
                                                <option value="KY">Kentucky</option>
                                                <option value="LA">Louisiana</option>
                                                <option value="MN">Minnesota</option>
                                                <option value="MS">Mississippi</option>
                                                <option value="MO">Missouri</option>
                                                <option value="OK">Oklahoma</option>
                                                <option value="SD">South Dakota</option>
                                                <option value="TX">Texas</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Select Grouped</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <select class="select2_group form-control">
                                                <optgroup label="Alaskan/Hawaiian Time Zone">
                                                    <option value="AK">Alaska</option>
                                                    <option value="HI">Hawaii</option>
                                                </optgroup>
                                                <optgroup label="Pacific Time Zone">
                                                    <option value="CA">California</option>
                                                    <option value="NV">Nevada</option>
                                                    <option value="OR">Oregon</option>
                                                    <option value="WA">Washington</option>
                                                </optgroup>
                                                <optgroup label="Mountain Time Zone">
                                                    <option value="AZ">Arizona</option>
                                                    <option value="CO">Colorado</option>
                                                    <option value="ID">Idaho</option>
                                                    <option value="MT">Montana</option>
                                                    <option value="NE">Nebraska</option>
                                                    <option value="NM">New Mexico</option>
                                                    <option value="ND">North Dakota</option>
                                                    <option value="UT">Utah</option>
                                                    <option value="WY">Wyoming</option>
                                                </optgroup>
                                                <optgroup label="Central Time Zone">
                                                    <option value="AL">Alabama</option>
                                                    <option value="AR">Arkansas</option>
                                                    <option value="IL">Illinois</option>
                                                    <option value="IA">Iowa</option>
                                                    <option value="KS">Kansas</option>
                                                    <option value="KY">Kentucky</option>
                                                    <option value="LA">Louisiana</option>
                                                    <option value="MN">Minnesota</option>
                                                    <option value="MS">Mississippi</option>
                                                    <option value="MO">Missouri</option>
                                                    <option value="OK">Oklahoma</option>
                                                    <option value="SD">South Dakota</option>
                                                    <option value="TX">Texas</option>
                                                    <option value="TN">Tennessee</option>
                                                    <option value="WI">Wisconsin</option>
                                                </optgroup>
                                                <optgroup label="Eastern Time Zone">
                                                    <option value="CT">Connecticut</option>
                                                    <option value="DE">Delaware</option>
                                                    <option value="FL">Florida</option>
                                                    <option value="GA">Georgia</option>
                                                    <option value="IN">Indiana</option>
                                                    <option value="ME">Maine</option>
                                                    <option value="MD">Maryland</option>
                                                    <option value="MA">Massachusetts</option>
                                                    <option value="MI">Michigan</option>
                                                    <option value="NH">New Hampshire</option>
                                                    <option value="NJ">New Jersey</option>
                                                    <option value="NY">New York</option>
                                                    <option value="NC">North Carolina</option>
                                                    <option value="OH">Ohio</option>
                                                    <option value="PA">Pennsylvania</option>
                                                    <option value="RI">Rhode Island</option>
                                                    <option value="SC">South Carolina</option>
                                                    <option value="VT">Vermont</option>
                                                    <option value="VA">Virginia</option>
                                                    <option value="WV">West Virginia</option>
                                                </optgroup>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Select Multiple</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <select class="select2_multiple form-control" multiple="multiple">
                                                <option>Role Seçin</option>
                                                <option>Admin</option>
                                                <option>Developer</option>
                                                <option>Test</option>

                                            </select>
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Input Tags</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <input id="tags_1" type="text" class="tags form-control" value="social, adverts, sales" />
                                            <div id="suggestions-container" style="position: relative; float: left; width: 250px; margin: 10px;"></div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-3 col-sm-3 col-xs-12 control-label">
                                            Checkboxes and radios
                                            <br>
                                            <small class="text-navy">Normal Bootstrap elements</small>
                                        </label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" value=""> Option one. select more than one options
                                                </label>
                                            </div>
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" value=""> Option two. select more than one options
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" checked="" value="option1" id="optionsRadios1" name="optionsRadios"> Option one. only select one option
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" value="option2" id="optionsRadios2" name="optionsRadios"> Option two. only select one option
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-3 col-sm-3 col-xs-12 control-label">
                                            Checkboxes and radios
                                            <br>
                                            <small class="text-navy">Normal Bootstrap elements</small>
                                        </label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" class="flat" checked="checked"> Checked
                                                </label>
                                            </div>
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" class="flat"> Unchecked
                                                </label>
                                            </div>
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" class="flat" disabled="disabled"> Disabled
                                                </label>
                                            </div>
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" class="flat" disabled="disabled" checked="checked"> Disabled & checked
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" class="flat" checked name="iCheck"> Checked
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" class="flat" name="iCheck"> Unchecked
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" class="flat" name="iCheck" disabled="disabled"> Disabled
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" class="flat" name="iCheck3" disabled="disabled" checked> Disabled & Checked
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Switch</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <div class="">
                                                <label>
                                                    <input type="checkbox" class="js-switch" checked /> Checked
                                                </label>
                                            </div>
                                            <div class="">
                                                <label>
                                                    <input type="checkbox" class="js-switch" /> Unchecked
                                                </label>
                                            </div>
                                            <div class="">
                                                <label>
                                                    <input type="checkbox" class="js-switch" disabled="disabled" /> Disabled
                                                </label>
                                            </div>
                                            <div class="">
                                                <label>
                                                    <input type="checkbox" class="js-switch" disabled="disabled" checked="checked" /> Disabled Checked
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
                            @*<script src="~/js/jquery.min.js"></script>
                            <script src ="~/js/bootstrap.min.js"></script>
                            <script src="~/js/other/moment.min.js"></script>
                            <script src="~/js/daterangepicker.js"></script>
                            <script src="~/js/bootstrap-wysiwyg.min.js"></script>            
                            <script src="~/js/prettify.js"></script>
                            <script src="~/js/switchery.min.js"></script>
                            <script src="~/js/select2.full.min.js"></script>*@

                            <script>

                var theme = {
                     //renkler
                    color: [
                        '#23e600', '#052ec7', '#fea80c', '#d400a5',
                        '#9B59B6', '#8abb6f', '#759c6a', '#bfd3b7'
                    ],


                    title: {
                        itemGap: 8,
                        textStyle: {
                            fontWeight: 'normal',
                            color: '#408829'
                        }
                    },

                    dataRange: {
                        color: ['#1f610a', '#97b58d']
                    },

                    toolbox: {
                        color: ['#408829', '#408829', '#408829', '#408829']
                    },

                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.5)',
                        axisPointer: {
                            type: 'line',
                            lineStyle: {
                                color: '#408829',
                                type: 'dashed'
                            },
                            crossStyle: {
                                color: '#408829'
                            },
                            shadowStyle: {
                                color: 'rgba(200,200,200,0.3)'
                            }
                        }
                    },

                    dataZoom: {
                        dataBackgroundColor: '#eee',
                        fillerColor: 'rgba(64,136,41,0.2)',
                        handleColor: '#408829'
                    },
                    grid: {
                        borderWidth: 0
                    },

                    categoryAxis: {
                        axisLine: {
                            lineStyle: {
                                color: '#408829'
                            }
                        },
                        splitLine: {
                            lineStyle: {
                                color: ['#eee']
                            }
                        }
                    },

                    valueAxis: {
                        axisLine: {
                            lineStyle: {
                                color: '#408829'
                            }
                        },
                        splitArea: {
                            show: true,
                            areaStyle: {
                                color: ['rgba(250,250,250,0.1)', 'rgba(200,200,200,0.1)']
                            }
                        },
                        splitLine: {
                            lineStyle: {
                                color: ['#eee']
                            }
                        }
                    },
                    timeline: {
                        lineStyle: {
                            color: '#408829'
                        },
                        controlStyle: {
                            normal: { color: '#408829' },
                            emphasis: { color: '#408829' }
                        }
                    },


                    textStyle: {
                        fontFamily: 'Arial, Verdana, sans-serif'
                    }
            };

                $(document).ready(function () {


                function DateFormat(vl) {
                    var value = new Date
                        (
                        parseInt(vl.replace(/(^.*\()|([+-].*$)/g, ''))
                        );
                    var dat = value.getDate() +
                        "/" +
                        (value.getMonth() + 1) +
                        "/" +
                        value.getFullYear();

                    var time = value.getHours() +
                        ":" +
                        value.getMinutes()
                    return time.toString();
                    }
                    DailyChartData();
                $('#btnListDaily').click(function () {
                    DailyChartData();
                });

                function DailyChartData() {

                    var beginDate = $('input[name="beginDaily"]').val();


                    if (!beginDate || beginDate.length == 0) {
                        beginDate = new Date().toISOString();
                    }

                    $.ajax({
                        type: "get",
                        url: "/Home/GetLineChart",
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        data: { beginDate: beginDate, stationId: @Model },
                        success: function (data) {
                            var echartLine = echarts.init(document.getElementById('echart_line'), theme);

                            echartLine.setOption({

                                tooltip: {
                                    trigger: 'axis'

                                },
                                lineStyle: {
                                    normal: {
                                        type: 'solid'
                                    }
                                },
                                //legend: {
                                //    x: 200,
                                //    y: 20,
                                //    data: ['Daily Production (kW)', 'Irradiation (W/m²)', 'Energy (MWh)']
                                //},
                                toolbox: {
                                    show: true,
                                    feature: {
                                        mark: { show: false },
                                        dataZoom: { show: false },
                                        dataView: { show: false },
                                        magicType: {
                                            show: true,
                                            title: {
                                                line: 'Line',
                                                bar: 'Bar',
                                                stack: 'Stack',
                                                tiled: 'Tiled'
                                            },
                                            type: ['line', 'bar', 'stack', 'tiled']
                                        },
                                        restore: {
                                            show: true,
                                            title: "Restore"
                                        },
                                        saveAsImage: {
                                            show: true,
                                            title: "Save Image"
                                        }
                                    }
                                },
                                calculable: true,
                                dataZoom: [
                                    {
                                        show: true,
                                        realtime: true,
                                        start: 0,
                                        end: 100
                                    },
                                    {
                                        type: 'inside',
                                        realtime: true,
                                        start: 0,
                                        end: 100
                                    }
                                ],

                                xAxis: [{
                                    type: 'category',
                                    boundaryGap: false,
                                    scale: true,
                                    axisLabel: {
                                        formatter: function (value, index) {

                                            var date = new Date(value);
                                            var time = value.split(':');
                                            return time[0].toString()+':00             ';

                                        }

                                    },


                                    data: data.map(function (a) { return DateFormat(a._tarih); })
                                }],
                                yAxis: [
                                    {
                                        type: 'value',
                                        name: 'Production',
                                        axisLabel: {
                                            formatter: '{value} kW'
                                        },
                                        beginAtZero: true,
                                        steps: 100,
                                        stepValue: 100,
                                        max: 1700

                                    },
                                    {
                                        type: 'value',
                                        name: '                   Energy        Irradiation',
                                        axisLabel: {
                                            formatter: '{value} MWh'
                                        }
                                    },

                                    {
                                        type: 'value',
                                        name: '',
                                        axisLabel: {
                                            formatter: '             {value} W/m²'
                                        }
                                        //show: false,
                                        ,
                                        beginAtZero: true,
                                        steps: 100,
                                        stepValue: 100,
                                        max: 1400
                                    }
                                ],
                                series: [{
                                    name: 'Daily Production (kW)',
                                    type: 'line',
                                    smooth: true,
                                    itemStyle: {
                                        normal: {
                                            areaStyle: {
                                                type: 'default'
                                            }
                                        }
                                    },
                                    data: data.map(function (a) { return a._gunlukUretim; }),

                                    markPoint: {
                                        symbol: 'pin',
                                        //symbolSize:80,
                                        label: {
                                            normal: {
                                                textStyle: {
                                                    color: '#000',
                                                    fontWeight: 'bold',
                                                    fontSize: 10
                                                }
                                            }
                                        },
                                        data: [{
                                            type: 'max',
                                            name: 'Maximum Production (kW)'
                                        }]
                                    }
                                }, {
                                        name: 'Irradiation (W/m²)',
                                    type: 'line',
                                    smooth: true,
                                    yAxisIndex: 2,
                                    itemStyle: {
                                        normal: {
                                        }
                                    },
                                    data: data.map(function (a) { return a._isinim; })
                                }, {
                                    name: 'Energy (MWh)',
                                    type: 'line',
                                    yAxisIndex: 1,
                                    smooth: false,
                                    itemStyle: {
                                        normal: {
                                        }
                                    },
                                    data: data.map(function (a) { return a._enerji; })
                                }, {
                                    name: 'MAX (kW)',
                                    type: 'line',
                                    data: data.map(function (a) { return a._max; })
                                }]

                            });


                        }
                    });
                }
               //Üretim Grafik bit.



            //DateTimePicker bas.
                $('#single_cal4').daterangepicker({
                    singleDatePicker: true, locale: {
                        format: 'DD/MM/YYYY'
                    },
                    singleClasses: "picker_4"
                }, function (start, end, label) {
                    console.log(start.toISOString(), end.toISOString(), label);
                });
                $('#single_cal5').daterangepicker({
                    singleDatePicker: true, locale: {
                        format: 'DD/MM/YYYY'
                    },
                    singleClasses: "picker_4"
                }, function (start, end, label) {
                    console.log(start.toISOString(), end.toISOString(), label);
                });

                $('#inpHour').daterangepicker({
                    singleDatePicker: true, locale: {
                        format: 'DD/MM/YYYY'
                    },
                    singleClasses: "picker_4"
                }, function (start, end, label) {
                    console.log(start.toISOString(), end.toISOString(), label);
                });

                $('#inpAkim').daterangepicker({
                    singleDatePicker: true, locale: {
                        format: 'DD/MM/YYYY'
                    },
                    singleClasses: "picker_4"
                }, function (start, end, label) {
                    console.log(start.toISOString(), end.toISOString(), label);
                });

                $('#inpHour').daterangepicker({
                    singleDatePicker: true, locale: {
                        format: 'DD/MM/YYYY'
                    },
                    singleClasses: "picker_4"
                }, function (start, end, label) {
                    console.log(start.toISOString(), end.toISOString(), label);
                });
               //DateTimePicker bit.
                });

                            </script>

    }
}
